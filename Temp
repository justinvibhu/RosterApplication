// Function to extract all PropertyName and PropertyValue pairs
function extractAllPropertyValues() {
    var criteriaExpressions = xmlDoc.getElementsByTagName("CriteriaExpression");
    var results = [];

    // Adding UserId and AppName directly to the results
    var userId = xmlDoc.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", "UserId")[0].textContent.trim();
    results.push({ propertyName: "UserId", propertyValue: userId });

    var appName = xmlDoc.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", "AppName")[0].textContent.trim();
    results.push({ propertyName: "AppName", propertyValue: appName });

    // Iterating through CriteriaExpression elements to extract PropertyName and PropertyValue pairs
    for (var i = 0; i < criteriaExpressions.length; i++) {
        var criteria = criteriaExpressions[i];
        var propertyNames = criteria.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", "PropertyName");
        var propertyValues = criteria.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", "PropertyValue");
        if (propertyNames.length > 0 && propertyValues.length > 0) {
            var propertyName = propertyNames[0].textContent.trim();
            var propertyValue = propertyValues[0].textContent.trim();
            results.push({ propertyName: propertyName, propertyValue: propertyValue });
        }
    }
    return results;
}

// Get all values
var propertyValues = extractAllPropertyValues();
propertyValues.forEach(function (item) {
    print("Property Name:", item.propertyName);
    print("Property Value:", item.propertyValue);
});




// Your XML string with namespace declarations
var xmlStr = `
<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:ns4="http://services.metlife.com/standards/smartservice/controlmessage"
               xmlns:ns3="urn:com.metlife.ead.channels.services.formDocument.formDocumentV4"
               xmlns:ns2="http://MetLife/CMM/FormDocument"
               xmlns="http://services.metlife.com/standards/pingsvc">
    <ns2:RequestHeader>
        <ns2:UserId>74345-00371924117</ns2:UserId>
        <ns2:UserDate>2024-03-20</ns2:UserDate>
        <ns2:UserTime>07:02:51</ns2:UserTime>
        <ns2:VendorApp>
            <ns2:AppName>MYBENEFITS</ns2:AppName>
        </ns2:VendorApp>
        <ns2:TransTrackingID>9c6269ef-2195-4fe2-a194-bc9dc6a81646</ns2:TransTrackingID>
        <ns2:TransType>eForms</ns2:TransType>
        <ns2:TransSubType>Search eForms</ns2:TransSubType>
        <ns2:BusinessService>
            <ns2:ServiceName>searchFormDocument</ns2:ServiceName>
        </ns2:BusinessService>
        <ns2:TransExeDate>2024-03-20</ns2:TransExeDate>
        <ns2:TransExeTime>07:02:51</ns2:TransExeTime>
    </ns2:RequestHeader>
    <ns2:Search>
        <ns2:CriteriaOperator>AND</ns2:CriteriaOperator>
        <ns2:CriteriaExpression>
            <ns2:Criteria>
                <ns2:ObjectType>Met_FormAssociation</ns2:ObjectType>
                <ns2:PropertyName>Met_ClientId</ns2:PropertyName>
                <ns2:PropertyValue>74345</ns2:PropertyValue>
                <ns2:Operation>EQUALS</ns2:Operation>
                <ns2:ComparedObjectType>FormInstance</ns2:ComparedObjectType>
                <ns2:ComparedPropertyName>FormInstance.Met_FormAssociation.Met_ClientId</ns2:ComparedPropertyName>
            </ns2:Criteria>
        </ns2:CriteriaExpression>
        
        <!-- Your other CriteriaExpression elements go here -->

    </ns2:Search>
</soapenv:Body>
`;

// Import required Java classes
var ByteArrayInputStream = Java.type('java.io.ByteArrayInputStream');
var DocumentBuilderFactory = Java.type('javax.xml.parsers.DocumentBuilderFactory');
var InputSource = Java.type('org.xml.sax.InputSource');

// Parse the XML string
var factory = DocumentBuilderFactory.newInstance();
factory.setNamespaceAware(true);
var builder = factory.newDocumentBuilder();
var is = new InputSource(new ByteArrayInputStream(xmlStr.getBytes('UTF-8')));
var xmlDoc = builder.parse(is);

// Function to extract all PropertyName and PropertyValue pairs
function extractAllPropertyValues() {
    var criteriaExpressions = xmlDoc.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", "CriteriaExpression");
    var results = [];
    for (var i = 0; i < criteriaExpressions.getLength(); i++) {
        var criteria = criteriaExpressions.item(i);
        var propertyNames = criteria.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", "PropertyName");
        var propertyValues = criteria.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", "PropertyValue");
        if (propertyNames.getLength() > 0 && propertyValues.getLength() > 0) {
            var propertyName = propertyNames.item(0).getTextContent().trim();
            var propertyValue = propertyValues.item(0).getTextContent().trim();
            results.push({ propertyName: propertyName, propertyValue: propertyValue });
        }
    }
    return results;
}

// Get all values
var propertyValues = extractAllPropertyValues();
propertyValues.forEach(function (item) {
    print("Property Name:", item.propertyName);
    print("Property Value:", item.propertyValue);
});



















// XML string
var xmlStr = `<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:ns4="http://services.metlife.com/standards/smartservice/controlmessage"
               xmlns:ns3="urn:com.metlife.ead.channels.services.formDocument.formDocumentV4"
               xmlns:ns2="http://MetLife/CMM/FormDocument"
               xmlns="http://services.metlife.com/standards/pingsvc">

    <ns2:RequestHeader>
        <ns2:UserId>74345-00371924117</ns2:UserId>
        <ns2:UserDate>2024-03-20</ns2:UserDate>
        <ns2:UserTime>07:02:51</ns2:UserTime>
        <ns2:VendorApp>
            <ns2:AppName>MYBENEFITS</ns2:AppName>
        </ns2:VendorApp>
        <ns2:TransTrackingID>9c6269ef-2195-4fe2-a194-bc9dc6a81646</ns2:TransTrackingID>
        <ns2:TransType>eForms</ns2:TransType>
        <ns2:TransSubType>Search eForms</ns2:TransSubType>
        <ns2:BusinessService>
            <ns2:ServiceName>searchFormDocument</ns2:ServiceName>
        </ns2:BusinessService>
        <ns2:TransExeDate>2024-03-20</ns2:TransExeDate>
        <ns2:TransExeTime>07:02:51</ns2:TransExeTime>
    </ns2:RequestHeader>

    <ns2:Search>
        <ns2:CriteriaOperator>AND</ns2:CriteriaOperator>
        <ns2:CriteriaExpression>
            <ns2:Criteria>
                <ns2:ObjectType>Met_FormAssociation</ns2:ObjectType>
                <ns2:PropertyName>Met_ClientId</ns2:PropertyName>
                <ns2:PropertyValue>74345</ns2:PropertyValue>
                <ns2:Operation>EQUALS</ns2:Operation>
                <ns2:ComparedObjectType>FormInstance</ns2:ComparedObjectType>
                <ns2:ComparedPropertyName>FormInstance.Met_FormAssociation.Met_ClientId</ns2:ComparedPropertyName>
            </ns2:Criteria>
        </ns2:CriteriaExpression>
        
        <ns2:CriteriaExpression>
            <ns2:Criteria>
                <ns2:ObjectType>Met_FormAssociation</ns2:ObjectType>
                <ns2:PropertyName>Met_PlanCode</ns2:PropertyName>
                <ns2:PropertyValue>SOH</ns2:PropertyValue>
                <ns2:Operation>EQUALS</ns2:Operation>
                <ns2:ComparedObjectType>FormInstance</ns2:ComparedObjectType>
                <ns2:ComparedPropertyName>FormInstance.Met_FormAssociation.Met_PlanCode</ns2:ComparedPropertyName>
            </ns2:Criteria>
        </ns2:CriteriaExpression>
        
    </ns2:Search>

</soapenv:Body>`;

// Function to extract property value based on tag name with namespace prefix
function extractPropertyValue(tagName) {
    var xmlDoc = new DOMParser().parseFromString(xmlStr, "text/xml");
    var nodes = xmlDoc.getElementsByTagNameNS("http://MetLife/CMM/FormDocument", tagName);
    if (nodes.length > 0) {
        return nodes[0].textContent.trim();
    }
    return null; // Property not found
}

// Get the values
var userId = extractPropertyValue("ns2:UserId");
var appName = extractPropertyValue("ns2:AppName");
var metClientId = extractPropertyValue("ns2:Met_ClientId");
var metPlanCode = extractPropertyValue("ns2:Met_PlanCode");

// Print the values
console.log("UserId:", userId);
console.log("AppName:", appName);
console.log("Met_ClientId:", metClientId);
console.log("Met_PlanCode:", metPlanCode);








// Your XML string with namespace declarations
var xmlStr = `
<root xmlns:ns2="http://example.com/ns2">
    <CriteriaExpression>
        <ns2:objectType>metformAssociation</ns2:objectType>
        <ns2:PropertyName>Met_ClientId</ns2:PropertyName>
        <ns2:PropertyValue>74535</ns2:PropertyValue>
    </CriteriaExpression>
    <CriteriaExpression>
        <ns2:objectType>metformAssociation</ns2:objectType>
        <ns2:PropertyName>Met_Plancode</ns2:PropertyName>
        <ns2:PropertyValue>SOH</ns2:PropertyValue>
    </CriteriaExpression>
    <CriteriaExpression>
        <ns2:objectType>metformAssociation</ns2:objectType>
        <ns2:PropertyName>Met_Plancode</ns2:PropertyName>
        <ns2:PropertyValue>Dental-E</ns2:PropertyValue>
    </CriteriaExpression>
</root>
`;

// Import required Java classes
var ByteArrayInputStream = Java.type('java.io.ByteArrayInputStream');
var DocumentBuilderFactory = Java.type('javax.xml.parsers.DocumentBuilderFactory');
var InputSource = Java.type('org.xml.sax.InputSource');

// Parse the XML string
var factory = DocumentBuilderFactory.newInstance();
factory.setNamespaceAware(true);
var builder = factory.newDocumentBuilder();
var is = new InputSource(new ByteArrayInputStream(xmlStr.getBytes('UTF-8')));
var xmlDoc = builder.parse(is);

// Function to extract all PropertyName and PropertyValue pairs
function extractAllPropertyValues() {
    var criteriaExpressions = xmlDoc.getElementsByTagName("CriteriaExpression");
    var results = [];
    for (var i = 0; i < criteriaExpressions.getLength(); i++) {
        var criteria = criteriaExpressions.item(i);
        var propertyNames = criteria.getElementsByTagNameNS("http://example.com/ns2", "PropertyName");
        var propertyValues = criteria.getElementsByTagNameNS("http://example.com/ns2", "PropertyValue");
        if (propertyNames.getLength() > 0 && propertyValues.getLength() > 0) {
            var propertyName = propertyNames.item(0).getTextContent().trim();
            var propertyValue = propertyValues.item(0).getTextContent().trim();
            results.push({ propertyName: propertyName, propertyValue: propertyValue });
        }
    }
    return results;
}

// Get all values
var propertyValues = extractAllPropertyValues();
propertyValues.forEach(function (item) {
    print("Property Name:", item.propertyName);
    print("Property Value:", item.propertyValue);
});




//Search
// Import required Java classes
var ByteArrayInputStream = Java.type('java.io.ByteArrayInputStream');
var DocumentBuilderFactory = Java.type('javax.xml.parsers.DocumentBuilderFactory');
var InputSource = Java.type('org.xml.sax.InputSource');
var NodeList = Java.type('org.w3c.dom.NodeList');

// Your XML string
var xmlStr = `
<root>
    <CriteriaExpression>
        <ns2:objectType>metformAssociation</ns2:objectType>
        <ns2:PropertyName>Met_ClientId</ns2:PropertyName>
        <ns2:PropertyValue>74535</ns2:PropertyValue>
    </CriteriaExpression>
    <CriteriaExpression>
        <ns2:objectType>metformAssociation</ns2:objectType>
        <ns2:PropertyName>Met_Plancode</ns2:PropertyName>
        <ns2:PropertyValue>SOH</ns2:PropertyValue>
    </CriteriaExpression>
    <CriteriaExpression>
        <ns2:objectType>metformAssociation</ns2:objectType>
        <ns2:PropertyName>Met_Plancode</ns2:PropertyName>
        <ns2:PropertyValue>Dental-E</ns2:PropertyValue>
    </CriteriaExpression>
</root>
`;

// Parse the XML string
var factory = DocumentBuilderFactory.newInstance();
factory.setNamespaceAware(true);
var builder = factory.newDocumentBuilder();
var is = new InputSource(new ByteArrayInputStream(xmlStr.getBytes('UTF-8')));
var xmlDoc = builder.parse(is);

// Function to extract all PropertyName and PropertyValue pairs
function extractAllPropertyValues() {
    var criteriaExpressions = xmlDoc.getElementsByTagName("CriteriaExpression");
    var results = [];
    for (var i = 0; i < criteriaExpressions.getLength(); i++) {
        var criteria = criteriaExpressions.item(i);
        var propertyNames = criteria.getElementsByTagName("ns2:PropertyName");
        var propertyValues = criteria.getElementsByTagName("ns2:PropertyValue");
        if (propertyNames.getLength() > 0 && propertyValues.getLength() > 0) {
            var propertyName = propertyNames.item(0).getTextContent().trim();
            var propertyValue = propertyValues.item(0).getTextContent().trim();
            results.push({ propertyName: propertyName, propertyValue: propertyValue });
        }
    }
    return results;
}

// Get all values
var propertyValues = extractAllPropertyValues();
propertyValues.forEach(function (item) {
    print("Property Name:", item.propertyName);
    print("Property Value:", item.propertyValue);
});

























function extractPropertyValue(propertyName) {
    var propertyNodes = xmlDoc.getElementsByTagName("for:PropertyName");
    for (var i = 0; i < propertyNodes.getLength(); i++) {
        var node = propertyNodes.item(i);
        if (node.getTextContent().trim() === propertyName) {
            var valueNode = node.nextSibling;
            return valueNode.getTextContent().trim();
        }
    }
    return null; // Property not found
}

// Get the values
var attachmentKey = extractPropertyValue("AttachmentKey");
var mimeType = extractPropertyValue("MimeType");



// Import required Java classes
var ByteArrayInputStream = Java.type('java.io.ByteArrayInputStream');
var DocumentBuilderFactory = Java.type('javax.xml.parsers.DocumentBuilderFactory');
var InputSource = Java.type('org.xml.sax.InputSource');

// Your XML string
var xmlStr = `
<CriteriaExpression>
    <CriteriaOperator>AND</CriteriaOperator>
    <Criteria>
        <ObjectType>Attachment</ObjectType>
        <!-- Document/Form Id -->
        <for:PropertyName>AttachmentKey</for:PropertyName>
        <for:PropertyValue>43132</for:PropertyValue>
        <Operation>EQUALS</Operation>
        <ComparedObjectType>FormInstance</ComparedObjectType>
        <ComparedPropertyName>FormInstance.Attachment.AttachmentKey</ComparedPropertyName>
    </Criteria>
    <Criteria>
        <ObjectType>Attachment</ObjectType>
        <!-- Document/Form type -->
        <for:PropertyName>MimeType</for:PropertyName>
        <for:PropertyValue>PDF</for:PropertyValue>
        <Operation>EQUALS</Operation>
        <ComparedObjectType>FormInstance</ComparedObjectType>
        <ComparedPropertyName>FormInstance.Attachment.MimeType</ComparedPropertyName>
    </Criteria>
</CriteriaExpression>
`;

// Parse the XML string
var factory = DocumentBuilderFactory.newInstance();
var builder = factory.newDocumentBuilder();
var is = new InputSource(new ByteArrayInputStream(xmlStr.getBytes('UTF-8')));
var xmlDoc = builder.parse(is);

// Function to extract property value based on property name with namespace prefix
function extractPropertyValueWithNamespace(propertyName) {
    var nodes = xmlDoc.getElementsByTagNameNS("*", propertyName);
    if (nodes.getLength() > 0) {
        return nodes.item(0).getTextContent().trim();
    }
    return null; // Property not found
}

// Get the values with namespace prefix
var attachmentKey = extractPropertyValueWithNamespace("for:PropertyName");
var mimeType = extractPropertyValueWithNamespace("for:PropertyValue");

print("Attachment Key:", attachmentKey);
print("MIME Type:", mimeType);




// Import required Java classes
var ByteArrayInputStream = Java.type('java.io.ByteArrayInputStream');
var DocumentBuilderFactory = Java.type('javax.xml.parsers.DocumentBuilderFactory');
var InputSource = Java.type('org.xml.sax.InputSource');

// Your XML string
var xmlStr = `
<CriteriaExpression>
    <CriteriaOperator>AND</CriteriaOperator>
    <Criteria>
        <ObjectType>Attachment</ObjectType>
        <!-- Document/Form Id -->
        <PropertyName>AttachmentKey</PropertyName>
        <PropertyValue>43132</PropertyValue>
        <Operation>EQUALS</Operation>
        <ComparedObjectType>FormInstance</ComparedObjectType>
        <ComparedPropertyName>FormInstance.Attachment.AttachmentKey</ComparedPropertyName>
    </Criteria>
    <Criteria>
        <ObjectType>Attachment</ObjectType>
        <!-- Document/Form type -->
        <PropertyName>MimeType</PropertyName>
        <PropertyValue>PDF</PropertyValue>
        <Operation>EQUALS</Operation>
        <ComparedObjectType>FormInstance</ComparedObjectType>
        <ComparedPropertyName>FormInstance.Attachment.MimeType</ComparedPropertyName>
    </Criteria>
</CriteriaExpression>
`;

// Parse the XML string
var factory = DocumentBuilderFactory.newInstance();
var builder = factory.newDocumentBuilder();
var is = new InputSource(new ByteArrayInputStream(xmlStr.getBytes('UTF-8')));
var xmlDoc = builder.parse(is);

// Function to extract property value based on property name
function extractPropertyValue(propertyName) {
    print("Extracting property value for:", propertyName);
    var criteriaNodes = xmlDoc.getElementsByTagName('PropertyName');
    for (var i = 0; i < criteriaNodes.getLength(); i++) {
        var node = criteriaNodes.item(i);
        if (node.getTextContent() === propertyName) {
            print("Found property:", propertyName);
            var valueNode = node.nextSibling;
            var value = valueNode ? valueNode.getTextContent().trim() : null;
            print("Extracted value:", value);
            return value;
        }
    }
    print("Property not found:", propertyName);
    return null; // Property not found
}

// Get the values
var attachmentKey = extractPropertyValue("AttachmentKey");
var mimeType = extractPropertyValue("MimeType");

print("Attachment Key:", attachmentKey);
print("MIME Type:", mimeType);





// Import required Java classes
var ByteArrayInputStream = Java.type('java.io.ByteArrayInputStream');
var DocumentBuilderFactory = Java.type('javax.xml.parsers.DocumentBuilderFactory');
var InputSource = Java.type('org.xml.sax.InputSource');

// Your XML string
var xmlStr = `
<CriteriaExpression>
    <CriteriaOperator>AND</CriteriaOperator>
    <Criteria>
        <ObjectType>Attachment</ObjectType>
        <!-- Document/Form Id -->
        <PropertyName>AttachmentKey</PropertyName>
        <PropertyValue>43132</PropertyValue>
        <Operation>EQUALS</Operation>
        <ComparedObjectType>FormInstance</ComparedObjectType>
        <ComparedPropertyName>FormInstance.Attachment.AttachmentKey</ComparedPropertyName>
    </Criteria>
    <Criteria>
        <ObjectType>Attachment</ObjectType>
        <!-- Document/Form type -->
        <PropertyName>MimeType</PropertyName>
        <PropertyValue>PDF</PropertyValue>
        <Operation>EQUALS</Operation>
        <ComparedObjectType>FormInstance</ComparedObjectType>
        <ComparedPropertyName>FormInstance.Attachment.MimeType</ComparedPropertyName>
    </Criteria>
</CriteriaExpression>
`;

// Parse the XML string
var factory = DocumentBuilderFactory.newInstance();
var builder = factory.newDocumentBuilder();
var is = new InputSource(new ByteArrayInputStream(xmlStr.getBytes('UTF-8')));
var xmlDoc = builder.parse(is);

// Function to extract property value based on property name
function extractPropertyValue(propertyName) {
    var criteriaNodes = xmlDoc.getElementsByTagName('PropertyName');
    for (var i = 0; i < criteriaNodes.getLength(); i++) {
        var node = criteriaNodes.item(i);
        if (node.getTextContent() === propertyName) {
            return node.getNextSibling().getTextContent().trim();
        }
    }
    return null; // Property not found
}

// Get the values
var attachmentKey = extractPropertyValue("AttachmentKey");
var mimeType = extractPropertyValue("MimeType");

print("Attachment Key:", attachmentKey);
print("MIME Type:", mimeType);
